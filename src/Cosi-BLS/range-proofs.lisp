;; range-proofs.lisp - blinded value range proofs
;;
;; DM/Emotiq  02/18
;; ------------------------------------------------------------------
#|
The MIT License

Copyright (c) 2018 Emotiq AG

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
|#
;; -------------------------------------------------------------------------
;; Compute a value range prover and verifier for use in validating
;; cryptographically blinded numbers. This version proves each bit of
;; the (integer) value. It produces a rather large structure of prime
;; number field integers, two per bit of every value being attested,
;; plus two more as cryptographic basis vector components for the
;; Pedersen Commitments offered for the value.
;;
;; Algorithm adapted to ECC crypto from the paper:
;;  "Bulletproofs: Short Proofs for Confidential Transactions and More" by
;;     Bunz, Bootle, Boneh, Poelstra, Wuille, and Maxwell.
;;       https://eprint.iacr.org/2017/1066.pdf

;; The code in this module now uses Bulletproofs for vector
;; dot-product proofs. That saves a considerable amount of memory.
;; Using Curve1174 with 252 bits per compressed ECC point, the cost is
;; roughly 1.4KB per proof, compared to a cost of 5.2KB for
;; non-Bulletproofs, atop an overhead in the basis vectors of around
;; 4.8KB.
;;
;; This code currently only provides list aggregation of proofs.
;; Algebraic aggregation will save even more memory, shrinking the
;; cost dramatically with an O(Log2(N)) cost on N-proof aggregates.

(in-package :range-proofs)

;; ------------------------------

(defvar *max-bit-length*  64)

;; ------------------------------------------------------------------

(defun rand-val ()
  ;; random value in Z_r
  (random-between 1 *ed-r*))

;; ------------------------------

(defun zero-vector (&optional (nel *max-bit-length*))
  ;; create a vector of zeros
  (make-array nel
              :initial-element 0))

(defun bits-vector (n &optional (nbits *max-bit-length*))
  ;; convert a value n into a bit vector. Each index into the vector
  ;; is the i'th bit of the value
  (let* ((arr (zero-vector nbits)))
    (loop for ix from 0 below nbits do
          (when (logbitp ix n)
            (setf (aref arr ix) 1)))
    arr))

(defun random-vec (&optional (nel *max-bit-length*))
  ;; construct a vector of unique random values
  (let ((vec (make-array nel)))
    (um:nlet-tail iter ((ix 0))
      (unless (>= ix nel)
        (let ((g  (rand-val)))
          (if (find g vec) ;; prob vanishingly small chance of duplication
              (iter ix)
            (progn
              (setf (aref vec ix) g)
              (iter (1+ ix))))
          )))
    vec))

(defun basis-pts (&optional (nel *max-bit-length*))
  ;; compute a vector of basis-vector curve points
  (let ((vec  (make-array nel)))
    (map-into vec (lambda (x)
                    (declare (ignore x))
                    (ed-projective (ed-random-generator)))
              vec)))

(defun pow-vec (y &optional (nel *max-bit-length*))
  ;; construct a vector of powers of y #(1 y y^2 ... y^(n-1))
  (let ((vec (make-array nel)))
    (do ((v  1  (m* v y))
         (ix 0  (1+ ix)))
        ((>= ix nel) vec)
      (setf (aref vec ix) v))))

(defun ones-vec (&optional (nel *max-bit-length*))
  ;; a vector of 1's
  (make-array nel :initial-element 1))

(defun twos-vec (&optional (nel *max-bit-length*))
  ;; a vector of powers of 2: #(1 2 2^2 2^3 ... 2^(n-1))
  (pow-vec 2 nel))

;; ------------------------------
;; Vector arithmetic over the modular prime field

(defun vec-decr (v k)
  (map 'vector (um:rcurry 'm- k) v))

(defun vec-incr (v k)
  (map 'vector (um:rcurry 'm+ k) v))

(defun vec-add (v1 v2)
  (map 'vector 'm+ v1 v2))

(defun vec-sub (v1 v2)
  (map 'vector 'm- v1 v2))

(defun vec-scale (v k)
  (map 'vector (um:curry 'm* k) v))

(defun vec-hadamard-prod (v1 v2)
  (map 'vector 'm* v1 v2))

(defun vec-dot-prod (v1 v2)
  (reduce 'm+ (vec-hadamard-prod v1 v2)))

;; ------------------------------

(defun poly-dot-prod (poly1 poly2)
  ;;
  ;; Produce a dot-product polynomial from two polynomials with vector
  ;; coeffs. Polynomials are vectors with element at index ix
  ;; representing the ix'th order coefficient. But these coefficients
  ;; are themselves vectors of prime field integers.
  ;;
  (let ((vec   (make-array (+ (length poly1) (length poly2) -1)
                           :initial-element 0)))
    (loop for v1 across poly1
          for ix from 0
          do
          (loop for v2 across poly2
                for jx from ix
                do
                (setf (aref vec jx)
                      (m+ (aref vec jx)
                          (vec-dot-prod v1 v2)))
                ))
    vec))

;; ------------------------------
;; Pedersen Commitments

(defun simple-commit (hpt blind val)
  ;; commit to a value val with blinding blind*Hpt
  (ed-add (ed-mul hpt blind)
          (ed-nth-pt val)))

(defun vec-commit (hpt blind hs hvec gs gvec)
  ;; form a vector commitment with basis vector gs,
  ;; blinding vector hs, and blinding term blind*Hpt
  (let ((pt (ed-mul hpt blind)))
    (loop for h across hs
          for hv across hvec
          for g across gs
          for gv across gvec
          do
          (setf pt (ed-add pt
                           (ed-add (ed-mul h hv)
                                   (ed-mul g gv)))))
    pt))

;; ------------------------------

(defstruct range-proof-block
  ;; curve and basis vectors
  basis   ;; should not change between blocks, so common public info
  proofs  ;; public values
  sum-cmt    ;; sum of commitments for this batch
  sum-gamma) ;; secret value = sum of gamma factors used

(defstruct (range-proof
            (:constructor %make-range-proof))
  ;; commitments
  vcmt acmt scmt t1cmt t2cmt
  ;; parameters
  tau_x mu t_hat
  ;; left, right vectors
  dot-proof
  ;; challenge values (Shamir-Fiat hash values)
  x y z)

(defstruct (dot-prod-proof
            (:constructor %make-dot-prod-proof))
  u pcmt a b xlrs)

;; ------------------------------

(defstruct bp-basis
  curve nbits hpt gs hs)

(define-symbol-macro *bhpt*    (bp-basis-hpt    *bp-basis*))
(define-symbol-macro *bgs*     (bp-basis-gs     *bp-basis*))
(define-symbol-macro *bhs*     (bp-basis-hs     *bp-basis*))
(define-symbol-macro *curve*   (bp-basis-curve  *bp-basis*))
(define-symbol-macro *nbits*   (bp-basis-nbits  *bp-basis*))

(defvar *bp-basis*
  (make-bp-basis :CURVE :CURVE-E382
                 :NBITS 64
                 :HPT #S(EDWARDS-ECC:ED-PROJ-PT :X 8612201293566734223588214747479929632715945648026515596982370269371032093827903093265729455403366112858677203832324
                                                :Y 1821798114335460303565536055342256524288679912211827130039032798322694849824110155707270855794041260417230591718638
                                                :Z 3057880493205124016415249835654380727692427883468021670259055934455824037910150821100059140045666675238527172125029)
                 :GS #(#S(EDWARDS-ECC:ED-PROJ-PT :X 5332639936434734650003747019746075753458135492755734981532663040983591077204897241150077468398462111163237533084740
                                                 :Y 3542688767209110274517396076140643299464619549463347635805964231103854148297861757426608419861271418311716030286857
                                                 :Z 7764447255252589797048739719225562154479580406607213770108715247755474047055609435335127026457360375960056083307210)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 7377930852289797863727046610229289130216756684038810408288205005520740688503346903082039874058863494180331839152470
                                                 :Y 5548642525911682434496221412757661435674849082088309105430477991022740058079980558735939730026182585576067614043671
                                                 :Z 5156495191280660529824009844462631022199639853690181071724403084400315333588472778982403722273234466157210871672221)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 4237216169021218580515104842060728003621087613869087533566397846020827623685208063927369893010812890103584717017316
                                                 :Y 5028678919754484567380522181247793286487194045616039419128158105287940126867542707084432044113774009483766652504834
                                                 :Z 2217934928736174653419936875652951171434344023378320936417250497795855635782006023753222554252844812712660177876609)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 4177526857554896763658955208847485886214467161756728590334554743810060660606558595711884161083672636217887600056952
                                                 :Y 7582874530560236923529876559282323988175131475035466158542997717224614454080718248367230426236784368344800709464255
                                                 :Z 6051064635132938077567973329912769251397857808791052324226661322517506765058166549532836819410966405257770808395196)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 1090606546638165138903320600847780762526748703194020754435043947562839857786259610359042006461129909898186022415630
                                                 :Y 4850862830779381209445282752819570568801149700103926095566209004365561983022545055341150392473734912995089971170546
                                                 :Z 2641467302265469471426872570809501498598604612065534219635413686798004297173355965965811199160334978401001373738076)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 6042877557748199407587173084647574134393753767023470517785547520705122194311444098962611122976577635895189667728095
                                                 :Y 4556238393606557057416962011020630740068955360755862571110830366362975254504245478294905530676470014684558559852311
                                                 :Z 5666826108386650951990840594863447521731371513228909772641704735415886108748580242022550482022491945037903013761049)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 8713257564118155301921570569692065733212041524981906324810600976832991230680046674021766789374756654273639948378031
                                                 :Y 6648138229588087282532696582500025188289903216924207834189839979576359895501034462327295643699826557649446766508429
                                                 :Z 8044905866959214190196851306932417761178473000526084151156653945419954670625386024136743064458627003788437574045606)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 7953484092696033884642099862343784027179669760402361676648633069366265355125980908859745575386374528577103864682989
                                                 :Y 4998568709079821000680290007505075500332944216131770253595930032632689945361507506593291939118691315720893393773221
                                                 :Z 8919396237528788035468607178719222741807820630120821496095324624613594324157426226510583782266831039318986205378418)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 4851249361304453365768997112010401634017036122802971762031189855349930671182432493124632515090666182485985207855992
                                                 :Y 5186524440699423204308886592832416245110523262038820512454249355030983270494478592879960269911027600199056714698485
                                                 :Z 1575270292169957961096186888549784038851532094422215236595322878569423384173019640164835446820453987249124098878714)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 7278202269367814038300555817102744170827342679662705390005972978401682448262464098202471756725280971677346517048167
                                                 :Y 7207400261926304532701435711447094337401668260086667965252400899835465165284578998420614052951795363199431652490434
                                                 :Z 2549152684722625066383287783802804287072022516272626462714731954687447619838630081493582713845961095583867232072481)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 293194329009802618161281248007701300596887818549623930641440760802343511315046966258852306150762765527007165948748
                                                 :Y 6522758405772814728192076635698982724390887620733016344485404080301503632793045285065421800530108165983230240246606
                                                 :Z 3773142279678417960929900135159200195964484925194451783785355568755196571718823034563899585733772845047418470442025)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 4498440663751384209876269606954833148569096035982676273191067040556765816974908548634117665682128995779977312044082
                                                 :Y 9678034746256250661761976072878235217666285167600217872155629278450419798827772807087820579503254787608445447394368
                                                 :Z 7017634370569239158254698918036240573742073554385280191857858984612828508165381892363915759859635143767500486812853)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 9810804353652874344447195687218095985255369397442294914962097468262444327400199649498092501364708854256555066421860
                                                 :Y 7873137081079944052332587606658744127484121945523952766362581264075438784266623197464127468342482613893755483607226
                                                 :Z 8665993104991338380935451458844451828545496033747942428473120985036911986154849668644160642055156745373220902163158)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 7498534976285217469573605684708199921908255493928313605911104354240469101711386172536324824801639579916336938902430
                                                 :Y 6270479449823564931136215970831658964069175921455042527404048382011477661308189894152672973476219428811270298536796
                                                 :Z 7551476038204566889269095164643876549369265437800662777945055325014474413417558771486247079292202783948245294229760)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 9481582439343160572930079390519983252804512065134875746024967345217387920046922042537550522171091386648176464522526
                                                 :Y 4393249638377952308817609150163682952224526706760122254927845277157100901981667906952602731719981013137826826590361
                                                 :Z 3132174820360214182407151710114069680401066678488268867141805216891302851098395570271005876182136737226664897814887)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 4602872105592588151978557148623500547540192599751748662800254608890029774281886417407525239703857023441343926799742
                                                 :Y 1637246001435292300694452995029406705303299064787895044689003243228402305455416513291269188341935737986129460990963
                                                 :Z 2934363089242389616025814691021220004817071319697894933775580112204588613456149962040245038455534039771875922585315)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 1544017297538216099328824905119241799806076234681349578808415247006575379565924087056815611744383626057779218089524
                                                 :Y 4800035572566775763301816850477741847251537482690059242084093438692195451233876943793659257542469029925817091042648
                                                 :Z 8224087583328525541656757587132964642546489256943980947496305330785365740027050520469780319582983506006225728164160)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 9350781908569776841264304475183334827479001414008616892110060732147669514096896822337826713745311250859387296549416
                                                 :Y 4261614497367850005331260604093121388922101239269404700140232114231735693923437343459924791029258390515156340681862
                                                 :Z 6717852002646804563735701568597273262494673609924893671833793639402885211680760648541347315033007643685063246686522)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 7292504091164799995922555229692627175558389741733708938117368956157936239323027131904499834898164975990252276738731
                                                 :Y 6894835634789741203801171332292042351833263416643062182175923802878215692294900178781605391343524495385130986586598
                                                 :Z 5460501463269564985046313069452922634003037774932399771523556853075285555182074399718753011511916226876740904666609)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 8591589002349900148417810272072429440612654580755340504434876826620368430414253184758129777660133251683740926461355
                                                 :Y 6848258219341358506934089942831351306046832357723689886983360422126190966472900283377053178165200845483094053495568
                                                 :Z 874775590524246876880045848363724213819138259580455916394336995438993536719044813544841065969099895194551602517877)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 8946015416877768869760256351987184757568217389807618294149959510696235432555630765562780439455552366468032405882166
                                                 :Y 3770487864264804424226017050763922914071906110450199165411160493246764809300142362451765488987165419188686495291996
                                                 :Z 5186085276986158598414648523104124176721766209718938263334398671899242733419725177995370134253557393513792719354938)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 9735864629640415247445995103377368431677533514171454440121719791944153332828107279756599364561906297233181714539554
                                                 :Y 2213605301297979417723995502727328856496737466341281844813093195587274022745375503334357609581031599909825042525989
                                                 :Z 1853607599396889732227686987342614836904781256575847635956717111786925043576308431303699586628615257045730238031565)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 2790944577195098664534343083275596853964283531850452803806209928643384477400593428542559366715449353547406530928020
                                                 :Y 8863500113614699565342847805717389255690174136735685531809089128700702245704304911525093884391293238836979729079319
                                                 :Z 9288355768539489214612052887805721570599426626606271943348394304854441785554979638965359627770449293014205469332215)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 5864968224010058727818258295955048034027099871336439495383705048195913006091114634087298262639225913162953663663444
                                                 :Y 2269646001981184034143442832131500267743595739613568330843632618881936821170151677766055453093163418292294454906207
                                                 :Z 3810463133738795806293619002393285286632928539487794685055174065996490956600748781944232410744475597444686270254444)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 5309536691786364528806731857491072061697612030411086020263895820903194819971380042848311562955926650230021395144411
                                                 :Y 247383457527611267093995361768469187922175779146024602786889721978555546888858286858182073784344156508868507069303
                                                 :Z 4990989882080130649838937296878832489578418948880402112906483063235768354082982056665292464559153925850582450729963)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 984002294658949831814104382805448030969065919549285439184594816568092781929850626394455724205004000223262566862347
                                                 :Y 3316955461227516034076404206254594843532046998201860006834449617290864360772433336042955643799961149342192663145626
                                                 :Z 1289012006582370654105887303116295625628780317123962549574922252445997434117718386389763452807323532348566111763330)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 7285801354867917077055793813717514193746643541006036470295857162185778375810221574128426852277131241509829061032630
                                                 :Y 8671949533976758647140073139126721925738934932963714404408088225765415469992791820316289180211905149182508610198056
                                                 :Z 5380184494236264060432343756427349072898446054483371931494508845090808094342577171002933812626977490730852540157252)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 1344741195980537348525883825789180370108832994460031160221176817664049137794599496037433045822324003647773303985567
                                                 :Y 9708690849402791125184754780241271475847122230549310015448196786865903369575853404170723609577232282921366310395684
                                                 :Z 5211372126671240731314934122866425232534678864918981672128460012101218949000139265713577656267359741516698466598181)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 8959694316187273276946628086291335281741751085832567794902910260816629666668245780431856188105023725143924104210820
                                                 :Y 8523916052209094996080949077687296031112109691149243286076896224890236049187042781538847833468118921872177754630377
                                                 :Z 814777946374487264284856033190474573082783243675237452126640359884713981792010648938484141517614630561969811689030)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 5446305339926801628409387114805014236252480751005942066537329095332568306965099484897420993477942058171892426124072
                                                 :Y 8758725180414593506719723592839272894029462805550949457859970673731418272924179184484950210119736693437723483384201
                                                 :Z 811876942037678646597340214311680031988702854976358940385140941486287135950714851668289364682160492755563324097099)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 3033848247664992967055811594109523337417004591380035050717060025571343832447897636479896875184768370896264288725023
                                                 :Y 2306111494586102468552589881235719721061828757549057312052343398609505285945024289792451346650629658861356472188229
                                                 :Z 2948254177494698203680481006344523377305783219704769421328427612251065673945470749497853130365391831511946494220526)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 2927365110782389902780857281870888030094432716417131989855203260507365228265236212874184659339606505343706364000165
                                                 :Y 6941455983746364849453255096718875923610705047347091801798397365451638176472474739732195516452738809235118356980876
                                                 :Z 4423167684157189309966156047372471758600470509784993338921484669606319079679365550690549895331312438600795003988699)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 9285682479130375182952229265057897684607072250721213878307521155578853792985302109679939025275008901136610199417236
                                                 :Y 8725211807735505366055596050805551434689968993311063387161257003072849971724386396382662108534449367465544784235433
                                                 :Z 2724499387147279156118158576026379247513880819038530687303468929961120733749504673297955612249585445990930382599582)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 2945679407749803360608850150357175872299960548703502414156661673101164516267793009730617411906141320534464731018983
                                                 :Y 4251594239919160756602871002509934914139367607025799359405228063871161839831236542577700148445630153572113525111065
                                                 :Z 4606239557926223629479614013867020018783533833332524590013260719510384622381140356421290709096388836985741313564389)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 7469831197037439935651742346242113211988018351493038194873429788507192765388523074975115055599204842296121576795207
                                                 :Y 9148549985856168253273936149154997270798138933815294540939976134023981340279486516046194269732193525309626563336054
                                                 :Z 7236384812128295612027398213059207063000172783286676032537160176039845819465761868401784328478691092509015683416604)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 5644080402524182823888598267909509141231185376292234500732069822161597792759612183615787985758011206724122870316088
                                                 :Y 9782713751150897270039500528396375281213425232026897208606935610355109090777580191377418184676682957882309723440806
                                                 :Z 1747906358883573948572776106831797346807288248313411477099525704567771290319649941111274403810042667990962402228181)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 8282330169742083942323615348675899668625302579520096796839748432773526856153002818998000602111940050385833387524053
                                                 :Y 8011365725382712465026077701647373659469145597353609440283445151786991946141807884043413792719413034222581086705161
                                                 :Z 6145089035692199456668368844828851953158986260511680319580528526543999386536274758813612949999464571691058616551863)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 3894702173429007149336186547193718129258520723198272361358498181610801817391576928963633559087778939590666432985952
                                                 :Y 8424927364266159088057972510590550028374346121618164023164805152912294280865045705010608161305457340532656367767334
                                                 :Z 3348241727156047358689682083105294456143215754299835848776555455066370622651447231726811661013469825634997430493321)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 1670717049115409006295640259105389137030398309208416531135827815112571000310828683797554830168986954367053594219289
                                                 :Y 229254363684846550599222364485344003121307814849838604365317641132235826078654131059300425581808847214327367085028
                                                 :Z 5160175707511230812522493722086412678673699218322865203401798754859583238598308136720266348514314179820262011409769)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 688789018700988963351795020840215329524942463766205259176687915727510695966349540532779620834612391003816447342688
                                                 :Y 3448969475958042054448565737677526318261181118454504917977595070283120345675102980313662612202667248789804048565305
                                                 :Z 3582254835564997298671285100967404398397102642098288508270861030866770335173178551056412642243933443698218646605823)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 9212896238989146726792227844313549934261930161431401215134259529919129055092160204235494214412733032938058696898652
                                                 :Y 4475004344929599251584604675551558017168960198871954148909934931883561351361131157495451077738884244119307031780132
                                                 :Z 2935361639801648004126152369374327260714471936908118453649041205754886817790077331040965343734202526509225819658305)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 586978321296623466883129617855624172179625975244027171022567251235174535246950792225994623836550692167079815984390
                                                 :Y 4438905254787881723571373107875966782491811767915531857269499958849043703246065833159852673108899297538990755826278
                                                 :Z 9414907735561704165845482710583595530132675213093726566240097096353333092487351557271686774664167955978671158086176)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 1902454132045801452327414063310322195094514403542120080150630669242462349881535186874333106931413515745470505434906
                                                 :Y 5876881409129915703930645677757634847363954902856866379831710468408020241117993539755457104669997227270840192549190
                                                 :Z 1269738949275193647250978029588564906212970034490172922989146240979887333694415952649020236791301354668398159169448)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 5042319831348627169490150194923265503153955254808801519906433144726557245213799564073495531389047860787411077732945
                                                 :Y 1138676610530226370139395231480765786846754160545118827549849498189531108846579273373211632224511473530810249367838
                                                 :Z 8209850683474055000523818930966571514058230069805567491597424174699762637395656855931405810695311819389738490182677)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 8438938032576312161343387993680882803432574920191348257409872536793708091515712548417258228952647097632084545860360
                                                 :Y 9027763457515123115000038333489757422556657865434418365537479682927923136110294711411314650178473830159569536485722
                                                 :Z 8807988243640870025975153166449226654219406011983152778310476351574436885425206866633006911991744526353685177586627)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 1796597760423284425654815557004831334225377840683039767243897926238358666073652097560474152257694713328190906580870
                                                 :Y 731916953725088178281564428115452152241109697705934159061758475959296171684196535265709530096933434539784453482365
                                                 :Z 4007479340699251998622086716442160366674653156908907851034430805060104972610136416115391488672936495599909874774797)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 9637171064921378870176785228099183924743157740072304299915812330110241241171241894197044878459098830855481026904298
                                                 :Y 200911417086927446466468507986364168180304627101726828529156872040442970022688868701902278229863077382118522680258
                                                 :Z 3237961519980200572601175351298796133824437477110949912071388144856916180385937316299634852968266693278771561594715)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 5941359948363434625453561407422405982693051857185454611982454524309123858631195628695629156840771643827496017151195
                                                 :Y 2127568428834799357200403455778605825605752572644947829991933853941434164399769822634848790954788561711753441755966
                                                 :Z 5632655103856380410954148429818675207910480545051808949342058004253443535335640413656793037947415928870748249666823)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 9198034887177069598878343511722786070008244227079703251573388093357224940417659719293591273708489646060134259902048
                                                 :Y 5786702009516341851061096828179378796355826100275697967833461913339846348916767245641674146864292223557062714264860
                                                 :Z 3038988728444879562879525151330260743273267231856301798867480309681138999524503502543653544374455374203343889783887)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 4723520197966921659126127754897739179516569485763937570201158794411631589807726676950502448971034266048946894698316
                                                 :Y 8837663715311713348768181703656887188781564424810546688646147350177559030406826758951221998586524598617042243737250
                                                 :Z 2073111587967898808160920124446089028398985145825831881786413228408530679569878907580087842252163970292752820279973)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 6937529043525884598573465956992381480519411208896192974396235541083064864997643121346659334520271629499856992711451
                                                 :Y 7780966657772999736086438767353403381211889796866546012015604262146151920452440368720773787541423473504002006368622
                                                 :Z 7863896091036310832352071058954087502992830808932257941652028257661785373561971194871168543221254339799002542467755)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 4642391413495113110872182026058636791002621173888041414420431331338690692445641343836109122876471128332937969387318
                                                 :Y 1599559060636551127396292378712398327238953762594311473998477603478290690727099177047552206518681437467499974776995
                                                 :Z 8354433248294417944947851287656256740058712656962714687452882738974253189322646508986132510641924658542490349332219)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 5814026654431104587086294343412101640620700138051699590663360708559447414410450890078152651282388216676566942569842
                                                 :Y 1085124483826405604051786968236767188741693536429672775341369544615205306033793218956045342664023498353577974672812
                                                 :Z 8588014001389282005686830345957828158494233580482192780345108356264458241494014862803676311355024649852398888398047)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 6688902256133423196281170751526542735844195892724159169348600068475643559608981121182174334542857941536519947067757
                                                 :Y 6006942152289892342225117494910682909266304543899314195154451197024155630665455875566356970217835673766776944191305
                                                 :Z 2629824140163587535238340147529780098133982648747615871312215308910785738038061647112294002564318331879282315282659)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 5705840258845451198646377208057388793619083620449161247344537598920126972813428040668387269995115996858029768432670
                                                 :Y 6425512891005514303657276370062104111071251554169402887927367702479171722051521491382119651711725597353337785841186
                                                 :Z 3867996706400161864966994489731702511611999729216749433766510465057522079577681263126491659020295033530127338173093)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 1679455435710182444982005676080998659748183436754113173223767932400611779931215996611977404381299902727527102743367
                                                 :Y 3764001977653011133037650942362457838067366755010269653671812362022430171150222840288916048972979115935015651483026
                                                 :Z 5531309971193991403366199102338201856833482914085667163682832526843002256565666364651930549796845793748393812879393)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 996974520840141970625118232854864295239296234740254041175268795946332343493648251450296820743751416835596802775552
                                                 :Y 5928349194596980130182047575407239358737653327564761898596401689740790911823356171275093565409841024827927026939533
                                                 :Z 9276979850887473976181453826918953715238786313663884710606744649173294973479737701596602257715429356445503122556498)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 9121366292706491564849093092762883495957978728358731384147115954209016026371047822068592423277172270846314126977558
                                                 :Y 6107638013440738826422631871312737164314898983771842974753474446875558071397865923678264100706185664611015992525908
                                                 :Z 1613276766008270371033235397312465452422031677016409452677046532318788970868488946704837299084135009111499042097008)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 9261756852094888242473511872472733284353238923502294501849761044451500621408633735880879409097975188331113213736355
                                                 :Y 7028757741845041783793812371888582331807395239351967198002893075616196234616040779080166343254870015903588475389287
                                                 :Z 6947699550703962449405639741807165799391066227712880957085244740806633203563542821214544849947693957523368510103275)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 1701265229819915538909965688223793305904003840564287359310948811477986949208901292532722711321704671351504908218630
                                                 :Y 298021540832212140367732744313460546022368202870770285469610903892053260393993285244389163215237146942975960586243
                                                 :Z 5128775590948441623151973071785208040560713949354593170341493681349932720318096255614837894343009936768561706795483)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 1062144640463997698795068976562060390813989108190174858337256829774705142070416316121022926205730304694744574719182
                                                 :Y 8833859321548661613015391359767647222516628796341389818663781892363781117090546158503456557309524776748852849167294
                                                 :Z 1884724403745933431992365673823937143871881696124392547295465938776550000431108773603353544996849597300473376953549)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 1079225220291989026973586270661037402599790056082792422733169243879226206947922648790882519231691141974773520999255
                                                 :Y 7708649968859442431531929247048272972342406605018409791955901841219466942818928231787118861890695731175969610979731
                                                 :Z 8003070478825258226028870467142892915214320044230998783006768778392980769371953022845181886359590657089292487446151)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 2249403129234654620322477508173229761301508543620795333761648774646795495522483969025779963065932676068637340566821
                                                 :Y 2070367385341426401559988192083003653096340615494597240415865916572184484273765923178368663974359106178378742903471
                                                 :Z 1607298133317180086295342766474049603512235749501738347216528402549761428444844245213556265858053224307213728290292)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 2271152055611566508493401687345697349868441101367198871444204327803628929260890658038992153957848400920321602273879
                                                 :Y 9303736688363740002574330172796986672185286483408373823523575565883170668733634971271840880395033875821132636608493
                                                 :Z 7451515562997034687530877315500841862009047152535062565493253257417737384655497334011573976638709333543328602384851))
                 :HS #(#S(EDWARDS-ECC:ED-PROJ-PT :X 2558767872928433542484713041964542155808779749898524426240426060408500917159267811904512055422911392040758855817952
                                                 :Y 3173967478909156831285595710873086518983321770077972703399131140281499099251947292627104148679282975236936571464593
                                                 :Z 1480312786342685288446496827672618173995207192044359152587408348579172166879744721333469370060169790616639811724041)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 9004968536710126308451716452085651569373160138659146449773822434782327051691992115214603225067375572402873304389591
                                                 :Y 3273460780136502494316735118263990010843004327699746311515921090690348265098596979945435154028978852395637446241588
                                                 :Z 323711638393187583724542755938059247096889337010638278449903893678192997600021671399401739546242403459136492745500)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 1602746833881230686455054583527117605954202650639585493272539784063842394349033649761185305808051555137557431070788
                                                 :Y 3382242275773658203301870578416455888040238950957465596507113674817908346656297377651307046031338336718390367655944
                                                 :Z 3361858112448691606136935837906809430389499248488750970253640144497064455371270409020989980634304893400826658528067)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 1071106707391275096599489321089341694110478213981225481638105300447950288494108626265235772233129058024327918899444
                                                 :Y 6306069908009725177482440739658470415120621532864554307127944619515428378699880643682527905941023966810611553789623
                                                 :Z 8950838049502621425713878400230238273798082376221833328634151170225512765757360295126308797045779462266012189609013)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 3251077677810116379827522502936907539664192164451454805173766103239540726043107117949857022511265084166180160743075
                                                 :Y 1232492934318874915265654400128515162269980342187691270723217887113286927262862163349366850099550671087078041879511
                                                 :Z 9218834951683254553268624801353829014309535203428824526781879028345907082328006591907496751120715784463123569950017)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 2605862575773012917170988780797419136215260465620441735510493887603421490367218122637159013697267160721159035934386
                                                 :Y 6238128695884706547099448794026770534244967157800210494283990099953774410356497223440126234133405320044526669257501
                                                 :Z 7674899844117982837606477798349794530952033879463373737590097898879231879817177251059789373935454651472028520280246)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 8091452050155752419613043559224922519108015268098960596493615396686579601329079333707308985942739540136547066047329
                                                 :Y 6160813498944186038744340250365834212399363436600199792243004620376679927393498292142219899506869321943255044796907
                                                 :Z 4142134441309337313897604055555329437842433710878475654334971124830604518683120804545898912037185234897807852949066)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 4308168757164360785523312054397121224083778610464385816231884081538864198043047592540902863559464545273382213279670
                                                 :Y 4823841762439225821939864647722692718164441199157181138698887901931637293214793086095089020085536947361760919413672
                                                 :Z 8460583815138175439695597602040787010392419184562193769011710110949997104274068361891597316433578553814447537676112)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 5466213535897700289989991917195749827542663933205282615642165373077583485313185598487622253944245009008884881331018
                                                 :Y 9256589863082311584942446198430483441877543536197816413152929627027415802130672639138105805363812318979373847702168
                                                 :Z 5107613997293389697897202756112447296763734992632387982412275866300145928571624589607148633775610672363708276798036)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 4544827032277589766526799535185174288558210559631988420394302778107750357902638505962045987175866174576996750349231
                                                 :Y 9628840143936539819000513496911693095220865392488587207442869557012792456016423120206583326358704288348204720876450
                                                 :Z 3526177637386752461406744632549675570792228435825862522822472014600709543359283037407789510597717690085904389072914)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 8776531205145937314885428414133550303315933596158599308592498629320191485014289577766364020005405293129754662644684
                                                 :Y 6805529648661208930754825002592559029492703879724109853206571978149898991938275279944117074791523234822132429666486
                                                 :Z 9128753414188844030021722749919250319760610542574040005713628349160810372498239231621469718758101017500633691238585)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 7778983946102789264207241408262513443337159150699921860666322906087173808206283425555650436640054264267099088043814
                                                 :Y 6696534606513390398707148402353759602147843286124482012972610838683510024112757333523332959260798970431190999250014
                                                 :Z 9516915746300645677598147323676884711015671400695913064137585535386122938997639611923478966147557605450744454355676)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 1974833519862505250321416580708117830361939044086307206200469324682826193282265819736687608293813496582991871707926
                                                 :Y 8231819918947839484915451399022017385227928876447953700210901347967753006787473124696093733170651928735121283466247
                                                 :Z 6580366309641458034018354604189078977338590400582681727044117812586656202612414631823308748952181043775531574390715)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 8891917118264671192215306011310012653689086546472197521054202591103757337190664237096359400112428472263023342290968
                                                 :Y 92589616091704113985657101761652268742417924990896697811670669796055677076942460300887258614151782603605186182999
                                                 :Z 410216316978154549604681791837821617970946472642081144540605689240607147022867471317967529448999802221667899285808)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 767960078739640764735764985985770795152190093770672162110844129379236027905849463533786892192757870303985778100095
                                                 :Y 148851740764390135354121877511597603359935648263860433807411360088682718704141425143793431551141806136284553697847
                                                 :Z 9025106927973966225421056675478969024245697870104251948578016130462563160155720120387245357671279901885687669284675)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 6469205984269851212867015631200810554274876347173221607147436559091008842208027091845687590926704856579258790548436
                                                 :Y 6315896660516094229774156277719839585545628624696864928467934894339574935397356797445061180613102698033826321857291
                                                 :Z 2735482571865739086883718415016704855029931148741538863681178071974355187512389065937755902597186381059549849187008)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 5780028701555138427871457343265769548978063839095780790443765565090692932268540082532318263709085868103112161531748
                                                 :Y 1268341881489034399218771289249010887363936365493119684810834195552363376106793474759037695391448970514787633190139
                                                 :Z 5923877406314017357970855600158795209917361389162661904272834602281337893036274025365744501816651174107497856281143)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 2488246675452759989198672752096930656561912962416091564295437740784455419403345077321702956189453777425099464004137
                                                 :Y 806908291469836760062934518491505065654376401666367217990790830327047649088645280699948087308882284730891480914759
                                                 :Z 2656716828739801014616871348107927738878457465425352781474551841520700527465397893254031829214557339336917885023002)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 2999298098837672200083343814551710997961589664380476788558358419457732435633729827287138028483424886708868600571694
                                                 :Y 7021118325465686917416366440939587868484157890630758773334654281150940855414076165332594398033825355668834631905985
                                                 :Z 297079272706367349857974108066297574162658945792274426254289374018449482417647403414013538571516377621030321152130)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 5100145947417543564166223118035522535273327411620822479020785677368290683836174885220162748916101758992077241484910
                                                 :Y 1663683718908265922305988951325605870168606750696468031716012747106375200449862131898636954444445014066603087840689
                                                 :Z 3961421245584799829682272085060681723291960097622115729356619845956300923148493011403493300333081031996348442734292)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 7895137042480062838177898970099189208514618365499379204099157760210184226776127763037464264349077931447105155236276
                                                 :Y 2175045504477328113841055868812053514528189773768280522483761757463563862286021932462358525520812773808867761336859
                                                 :Z 8014903166308345886133487617992992924194391449168510446755957319602452565389027986898859668225085164674134954135170)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 367012847280159244654452199042706809961721835347416648475998134699830702337126285743093000731764228872572348756713
                                                 :Y 5090233840836607534277300487170533440645338049255241247718316742303408812842322105594631600815255792538779022555679
                                                 :Z 5482895972795771567874372390023477677394833041857853366088175889158187331072332080571677904916629109702391141182269)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 2176669665476006082895673392025878239849596184971519522039004945606905098657179701573298741403089768716001705043935
                                                 :Y 9368831416814558434100972100335883126891709411548313524118427243664651062494074741198778935013044767076970388679228
                                                 :Z 7256304694552004466125957658142257277301554598863112886583236461817076469219345566749467291705856569857535810079798)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 2332005395862269802341904750699428934686740364437804928651575301751418707418733617503239851862272165554962554307174
                                                 :Y 2793217255997402626246953576054237866051126841736638444390172922912293281842258001850783170507600110531504139436454
                                                 :Z 929074829068523315432336382883058826258527794464785528869416299116216933122663813249489466046490492847480778752391)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 9173762917465349910043925369803245525710191778155632209497246126492793794730267360604773377601561974969834054105937
                                                 :Y 6606457142672370187066252171352730367118803511475815031404595933975968023978671166561769896288836337886293875124145
                                                 :Z 7842551397631926282721674004076062066995328419027474358761954254320632035715762632648363184709780163805160116573436)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 9719346600290611546882305436761124277067473407270407761097640634087772309486327926122905349808352599034581332319884
                                                 :Y 9761240264728701373382656137113371229438719487676476074209984599887433690958791134180648535811875492641644741635970
                                                 :Z 2955959232054962163403702207798948062915931378100982165880652546047106743136084282083639514811091060171833076113987)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 2080098912966710763425246703351051716682945454290662397833562322666620886948571573670467797544531063236632942451317
                                                 :Y 1176935427941298124032599381666329759648795321554454814214717936474538596703314755083881086361945876821902238077436
                                                 :Z 1455939637882539664458588011748820786122566943471967422299987574186241013258109963160642065789564235466567934964645)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 5938629932642507269551864439892676182335749291703482761341313570064616546663920583906504694409079597036801636019998
                                                 :Y 1646942624288743743623626870581740079548676385777790688992775313564212322517618079642415458187498517710849996850372
                                                 :Z 993151124289687872911276365194529995776555266766299358699038597626440191059232046866890523158001909823452689136023)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 3792980169035647321861820784474635925684302397631094624086512296183416021142647607776270186218256070905239215428726
                                                 :Y 2095965596446613140241804452226623355655845162169991116252098823386823211112224659633746567991951316112320255084552
                                                 :Z 7742490672762032509308338634945257351801829720791580865674260478980562825221787506251781680340198018015211417302637)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 8875100104813811211685779590637378503074835498739308950338029695055701834907812870098878161254927838967162985274995
                                                 :Y 8339519791419096595449427296919111826299298021762647947888177146828861311614760702181392433496334856650497496377490
                                                 :Z 1479180270214113996489077472958361073166325026373831563113109074462856866917078382986084219462879962529569661787098)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 2886860608063928939299522118769509142360782087523297573851957455196418593504602886897464682019916353734313690072980
                                                 :Y 5273914009571318399001244835555111323369145353805573531926403956171270785847634865527903460655600984758750183876841
                                                 :Z 2814495635318715841118278417732169726334500260264151446798916131906743582670068046716119390903060969558679048018649)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 1115768176206259938855851360627159353126184759309851663830663364729368935661066655294671530952741433963931825511562
                                                 :Y 4478988501325192798642138316784333487236643959613179762757822793853564413889525696756882910013571769823923855500972
                                                 :Z 8461664472973972133316656320793140826002580630469759874985986943526603862132171711938151771059516565685090563291813)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 7725410184924339493404476347364827390012505099543342712335545919517533140944143105598344505763410775994776501565193
                                                 :Y 4444184172226968077794191972297823145551633395857127118443386905604217771179518887962512802369838709779180390585174
                                                 :Z 4467595436666370865376320276104762433769497443196286713697496288376415801727789541880627846182354640228067961250431)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 4795198328777452889886534394476634354561311485807003040808824035238972899831192229015185061566481736825865670767043
                                                 :Y 9551617311347865791333892273210447765301428390254747092392470229823930700036996037766426771039473587027279520989533
                                                 :Z 2677629915708037608901070141716829292897867350740629482740577271029039588057716701933117747394915999127217498489971)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 511412186922683603966450122752419128011188103412754316111929712952758529836838697133441806548095453600826121421139
                                                 :Y 7595604453547512778511798993811969432115710623132533256291742852490807609958082810947499304131236759608233222450222
                                                 :Z 2518793678386667362679642286120524209475363932298031425269086107967926203293582549534594903324364218860533754191427)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 6646860379135353154802215479884702121124450691307935195010900676020914187304977120248104919435746370006588630446087
                                                 :Y 1793348994491134795860012945325450222521944271447662945369073718553049077471938687006953615107906800899188215634917
                                                 :Z 378006467342571399075056082241897075071165854655781525722485197857469565400400308017145531947660646632198998277246)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 3560448586463037943895433239138669537474355039844399998109475321207951594912282035611837296454512294863021087622623
                                                 :Y 3004229562679778778084666922455620799775971859664748179636149247138762191479655531864596854389811900303807388311718
                                                 :Z 3049033297370426836669522808641714479939542133309512675163651891329592172458686891777318531301894029640444340269526)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 4560198325410196627888383406845327208366258811668514464434697321015227236049895302754955381858135523321941595127413
                                                 :Y 5521605683535234346804646407240264734628767993705005222842012230578885614020705312662374493777660869475827555619
                                                 :Z 3548282820331238569438834731297808489826925759317150339039988491760933365405550697716917545718869531073852657745993)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 6763720959661244798025342916504072175973039102013383818929829448571559636124977437234256352348360767137677850590036
                                                 :Y 7789253812309803598623585993143021531150777607515157982597139523195369143864341998555426700647873298143597722013104
                                                 :Z 6377283994076386428876573188501213506431590404861510222122506904840109798443112971899560184348565225098354718514545)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 4662387310989834278415078379724316614553086009350862092378905234334483878321893188018040868062618064820490734845824
                                                 :Y 9178332603603546845649776578017322244898626873235347360046984026013189990091202835951622012849479918559305549698915
                                                 :Z 675095974778342853945744109370969348790149457713591287861795470121756316266672805524638241440959058430098015639218)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 8082740779078843747329546784244851237337060553052436733611666688610332806012721233817826755714411619544880612987321
                                                 :Y 1368065256537094051506237706527209333391618148270476581812838517831878316863047652493887557078943074013544585437382
                                                 :Z 2503840362367767000976782716933449153281832535130789460994613518570008529086903183619394843295735125922176467451326)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 9713710674983004967334853056178501524701054170914085996690814588750845811133407158570664033653400297965789008906565
                                                 :Y 9295075917229129849342289778594959300528840892223322854820476950318778935338594213878101329454097544708486700447703
                                                 :Z 3014888043386884280554542158347217552695026616279454800643653405740632513245506775805381095595123512636587060771140)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 9109908132199534276003271223588644311511116877997675545235300591441817673224152181423925437035150824335365914170552
                                                 :Y 6742606305050571404350302484918632739938029861162319155344889964631592385235962816661223266996502687523491370978573
                                                 :Z 8737354248551812349766547827422218748303272507564409671549362923477098135285312517100301562653629106738552166254428)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 9328345074116262977249139490334255370463582256909567228939716167640101677935258398954425189812984613953995704458840
                                                 :Y 7241433028150930882088240969202088085984867731864057884388508788774603749098607434112297502088957336031372002585836
                                                 :Z 947579760741723984521515604380215508920413621630523655366029769562012911332094157827346452592840891466339423180739)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 3282237045429832432370808233901542824763051170719430217511771293035187419784642126959460661939198264726213978331437
                                                 :Y 3956806870375887887106140253576349050948008063291175896368039577419315564442581060738838244903694745559784592779593
                                                 :Z 2219760212137897638910703410157525243777858206724592869321536582266853160060638935896117965984915835548292114330480)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 7929441927613216709666771874900685451901030499736197471217849412817414190888866882653382645057703607443730741235737
                                                 :Y 5421405769187828311150267731403441497993093435698299616896692942677569590501536309396448928318651578238207986084006
                                                 :Z 5653021418302912303568247285971287520064050458129201864522025791057368112518298063955589880954187512417723372840546)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 1971897916032410232601904364632182530255681121910610731941401107890356064621274589710675792789321627001943518009014
                                                 :Y 2494331042178910629262247959422449474698860924229667832134222908384052976697666781144772661272112241650952567201637
                                                 :Z 9304806147767961416336027757611038388646037151452779636254058402305106814093267387133473428560023236862323982932018)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 7571180845507755415733369732770754093234511050610838500271391749776943465978215647104777464809849821971487710124495
                                                 :Y 8547760105855992719645026990619966110069722987724307258294044758592695227933281073118613285564920061101427744895406
                                                 :Z 4251647639142663174760407152382322005397794238560670683526786469125410446238831721539160659420798881071716940241020)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 5158589672634241214825794975589579075556241515834835714382020491370595764472179983088052513381184484051956021233437
                                                 :Y 7062705077775055082350203630976804304930600484560990454341637025414110731902098500125657688926273874817687911329935
                                                 :Z 6635792007432989288714310950753435848205641203002885566579277727501958153421957740458319536659446761005860773360877)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 3179632574453563143184908077614416030803304247712918887262846639491055922460115486314191020346261432108305753634370
                                                 :Y 7313414178667710177076394911423061366851173832523204351141650659993706133945946995744352393208889641362578100092272
                                                 :Z 6012976258235848343281717799021561975911355585420251838331577535762909997360918671431894065266670496863939818011371)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 3554500847925715099074591199936668838851225903264767491332422438068898424786388817284779677700484157032330249360912
                                                 :Y 5156901330659022330859981172280380686334327782643350136249321987637627408265436499593049451334853195790729238595001
                                                 :Z 2679873340680172909679253861265264055604369157442061619821188363266271286828251248202387500258932341548849391528955)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 6119558200481558281407051607999684740742666131399686683088308758924082608813765183099973492984379334380819575133083
                                                 :Y 1887733102234718222361578773485810728085856766859952676269171236102855520315304746620979566892180406071609020501780
                                                 :Z 9204392109500680123135451769337211485215983966398942862908296372807162495362461837959919135433212867079300976424294)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 2018606513398851015840698594668903239463785714379970507068152560994245347157689981412044489766767608650192168041542
                                                 :Y 2634338106864186178454620597691529197333979157894919031198204727761572036256884744950238954056490828070508019679221
                                                 :Z 5679307784452010956613724070709663763632934917101983034402165479569191009179191740969858888912656010402497324113012)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 59780417881124449252452063618579350572685056506248198424068085698228120790895412757350650308650344293217144027856
                                                 :Y 5829227440924110924337515546466169147622565878994593123425983049477047563225471451170355930115556529649392256375263
                                                 :Z 9130692714691773619026040920461799887580711296965266215599554590420371159368388897520159778661754307694241168227233)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 6241742503750656950003644050284612628027378987285236722199843056400382036622494033687087787103923024249710798466568
                                                 :Y 4318509635700503903031420454497017801072564228923780571184548284933018916628061342431210082906429192258948783196
                                                 :Z 8732452439177185310057480529742063779816095949516910238225648196956779609350779645766523194485685686907463663636230)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 9482403751034476862896943519800817915167114241503715571085045546473063698203728867170088037140488202622337705627231
                                                 :Y 2640290059652605549024914923620151023017295617322740353062055569045573612597845897446989237873089247614760574315377
                                                 :Z 3003863300573842565303080805794879295938034738196608053078949632682170701167240514765198624524179230387802360304498)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 8269735115868727780637703850918165258008123697560963810849511059683672291292433269189075885270672609147852411876983
                                                 :Y 4961468946011372073724658218401319132530075290106981002994774623838300428267093532324421407366844939351067689926685
                                                 :Z 8454614062556805683983092524623902295411689484455757771836065401912509794609258092922685677907414297304981052408931)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 9699303558649484942081088755728085170032842734543758090702957158924499374003868084825887597894979774885650430951730
                                                 :Y 2527088349474995268641392060184250690011783103415677250532294783667097704517085286331836414648865816302988653820871
                                                 :Z 7074489490955451845447452267805152231058250915295594333694413820823531894619231769731634970130071462292419045327856)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 3005967263631666067058261261693746538644857554991793071063050672195078242770034176019935089786004745558254462420773
                                                 :Y 1284355883776171291621907938086455048408693772253197187012325763579461098923045397167165959313567523432662605931062
                                                 :Z 9511315875700852741125546267895029025077851658146944483168078429587869935739094667404402038169561652938042093704953)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 5460979305171716974682737660614895878013871510299741740492718382512208646033914945297293107319727570220453687218545
                                                 :Y 5499420291966368918918393966125952953413591224472674350193480806473066329022131805096423327075486155013691799164917
                                                 :Z 2930591655651124292806889967061736025800359510850150698229490555043485950566816842416273635937590981933692439968719)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 3413518232510097916177770958705034733662873026736759809526673870344522713054786612159896854559366441697561386466015
                                                 :Y 7517569286452421276158793383153312577570539246200938859856439008398542941394732195074701359919459806030155756147337
                                                 :Z 5198775439618072362189798239619088739739768065359817927899599994872843107774251347532437287225020742166691108412632)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 7577702058985656937668675852346796355909074964983279349769067481277738293326083425942496505084724477013382244315835
                                                 :Y 6412079947975832834419609585180641751247630911687428439159969312001829477715907362627905839242814149718570226318654
                                                 :Z 8514845538248260583393209128581878015428757950621925320820569670350319450756878735781072981041720989725729793759169)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 6125229836271760279489124989866994093325163711901499108788521774008549816364126638694817529887657126911267540746674
                                                 :Y 4700693857406479934713986988699389145809802846962128390682204286227532848185342490147920202735716324711094544530236
                                                 :Z 8274089360318235469554036593705235866729429163133810925887367798843331160792330603983998907018277381684199497654544)
                       #S(EDWARDS-ECC:ED-PROJ-PT :X 889062972743768041546804727273658888676002956858668009233577071398646692510795350153124591801493350447732141784867
                                                 :Y 4526810534902653829814309264827436258898189794155722526799642945681683155117297138087736781274369683036122465401820
                                                 :Z 9507787602201723372052147491550764275248437713628282754480216598228666537920807278018546459799443464094514589685112))))

(defvar *chk-bp-basis*
  #xf517bb89109c3b7470a97f0c4b6fc1647e515f9426fbb5aa6f0786065e29c99d)


#|
(defvar *bp-basis*
  ;; define fully here for default basis so we have comparable proofs
  ;; across blockchain
  (make-bp-basis
   :CURVE :CURVE1174
   :NBITS 64
   :HPT #S(EDWARDS-ECC:ED-PROJ-PT :X 2182379953369641632517639022101150529277175724247236450426219701597546052439
                                  :Y 2089266500847130883365202273463507731036933536496786317289009790420135050657
                                  :Z 791658237893457670934264958707291846924673871180839117867589981661722103301)

   :GS #(#S(EDWARDS-ECC:ED-PROJ-PT :X 396235780688016554032868129331705408218242387283339730922972872599270438803
                                   :Y 344641427735155390040965214954916312974845847206979544943834932677635250565
                                   :Z 3378681058488412448716074069754687023002234253735195689779259143501661830886)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1987990942633475046473583083401113274275482488053215982980632964457962389145
                                   :Y 2645608141618561243970479824236980649797973787125024113216822181007771930766
                                   :Z 2636433997654346083389783037487591283751234476460052460242690998512128641343)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 3184052809341142676736027697711870969059549062583993903353730779859893108842
                                   :Y 402162013318274398165840708502474055831378545256799019890431732240152193449
                                   :Z 1740553370045420037643279239567851103577910534808070667585438446266181264341)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2405132613581348298874440842646398826420043206644707976605724832072513343712
                                   :Y 976752309182720061699188967211652843000692573784114417295762259845496758233
                                   :Z 1734318165483302648680465422185100521388514244509581940454090840698570563740)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1350450350328333011927250383950004387187992974718205101325382737702872807456
                                   :Y 2880247490223435944243807995384427501877031090684029502644649748248871326185
                                   :Z 2866012049561139769840401028040966834012878403835745410391825464219218992732)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 3117203903816444480012968748998747106562208040181766369660162933104489346895
                                   :Y 2239272710612333345869943428975577277232157250959267452514171762090489366007
                                   :Z 2911245230552905570363889508077750995074241793843052739653594119164147527617)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 571918261816871415865446168982195676061278592356357621494860743793180417914
                                   :Y 50153351822082203593953993985161661296931201199725675956108553084173361299
                                   :Z 1430924089095376386650884699870425677214553595902537948884708688104957911676)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2447747958663607805432148280319200555959829590359810364167573695102349528206
                                   :Y 1104358023665280214831272979013609768985381884631146084561380096401217967807
                                   :Z 3391667355140217654729928465722434353491753020456214589609352217262425195220)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2689175937628148512438678410814096041325994300510720182587422720102308364673
                                   :Y 1587416766107547438209303698528862937667306237515990117871085529363433670950
                                   :Z 28593243103563188765589711868757786231152481123855762230317021184427272593)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 93743271564130813960508050603342301113069645664976155422099819775754668579
                                   :Y 1055385650854527507927441388403048278874224729535968927771087809205220103219
                                   :Z 3030410261668508786268823250898247004659407671172836785159752097608840779559)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2473768975796292636974144424119937567012682978472608371107877030667612651603
                                   :Y 351864768553558313986552024548178131082412765701775231167168584176413220581
                                   :Z 3241385423271858612119807402701526158188789430299218618120724936469163474565)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 320662532658252310342590241518363618255729422881485077406157452418546606558
                                   :Y 3018446588149207762129643382269852356056298433056342071686074303795056082206
                                   :Z 566216449431528975418773574987308534853209878556569536858991048497968090216)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1558500136013029191075083251500518541024054259349891255390955447935017273764
                                   :Y 14450398392399333819137994891987022961016023371626918846900171552679536345
                                   :Z 478075018855269390599844711057428612990805509892253551100358772529503391594)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 3460788713543630260872016511813340485218265057679414362170526015687536211675
                                   :Y 3591862225294999725543154220947342981642069258276508585034786940496992696892
                                   :Z 430783515011705969432672569647721079005060251267996667751608376797284593268)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1483989378209896577757054429496511436198004045854382646122223284391873590364
                                   :Y 2225673257414540217688933132571011799486200647661706250357696142911849170958
                                   :Z 1171222180811566226251542340344962304567744018299225296812455801876644318927)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1818185538100334841841431520285024363290590758113870632668413007881738119248
                                   :Y 1061174191039697158892620198754906125646535397290481559487256347490958038751
                                   :Z 1291853822705881316895755469916342879997668321740508662989274335019702827970)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1158399650773936067829045492600298699742710651525843449139513423808627184525
                                   :Y 96981720767437861685154157449818269597954978919542211222978136849213654759
                                   :Z 2147268466493717957165490894927171361897813695141940367087868725722919550176)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2870505010750642130107712824371533598074214366524150566899341686017466274004
                                   :Y 470356294162327972810059653729107940217518410597338282827422816104600730497
                                   :Z 2964431697587210219952456802145701008453387970954423883142261489203650652317)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2000149873791626279701898088280501819984205081009817273086530320908799104080
                                   :Y 634560177964836446575718672619954702908717478929750811064121201049451041203
                                   :Z 3255568946289029560300574310880067494391303258267189900310338296343153583342)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1998213994221513187005150627118074941378822912406259504105143408904611608431
                                   :Y 2962368925656953940128978228672664612493486737537482328577015443219553011724
                                   :Z 1879517835228268047655574412567490495629271747235959169040257415997604269752)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1223456538608804881383577167708526799035064942224687592839096793695148200247
                                   :Y 125210518681317590108280434415718266737927447241116743016506281432806096157
                                   :Z 866751876454032267969664161911349819675934946359534201619649214356929833774)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 3198301741314381245771764173527903986505843389137643763623071949359398176172
                                   :Y 239104983620904326883741649416892976146554873255283276477609450129529713071
                                   :Z 3612172148688294858498720374956836568381447752091642108333862785202315811108)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 27810793488036081612375992405073528085550009059146136303492697199166742652
                                   :Y 376088500905696603745606622417831536650733948355026048069022977608137915065
                                   :Z 2630999431006445082542061287434519271440142601560470898147581467102335657589)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 389599856966820100305421785220281403008609980990044462428369726844808049278
                                   :Y 2444931388283245474121089767272717459762007514959568111676350562401270533383
                                   :Z 37360661417936004636612467036969788254414193311512718907253611143194848192)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 3192006471771817385611828889033430150680071583494778062505037880335719305853
                                   :Y 3213498637340409859005988125877684126316447892527971728597103762638701973325
                                   :Z 2341374824023746996683237302652017447011326680991489829479370445352800156136)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2903907786396648979427035353888892429104743411207301629121777967948135138183
                                   :Y 260873952444596574917049116032054088273338163094073527450744679187616641955
                                   :Z 2237128791523511912212950140729479316857072653070779714458876390112153367159)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 240074146340746723419349154963799934556435933646480902982633902881525865978
                                   :Y 311121591090439199618006032497030624943927359136833751491960476888262834533
                                   :Z 1371738065238721936337892883865643120503391365154925412215658708952110237840)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 743420734817841445937322687140317870540494366159979675793261054444309391017
                                   :Y 1661508769297299272091457646716619608119960312298721173687242343036706515223
                                   :Z 1193197496955792326794607048393055183291489004888641607849249205449968155264)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2829233591123463560398371133896987968644690029004855152701059538013326650517
                                   :Y 387465057680169017219775665419061258000408969592526424693191965477757583832
                                   :Z 1267132550969815516410319851060514319196557067684267198035837162958727306694)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1877151942976592898654032893310108272853702514489888147421250971241515671330
                                   :Y 92150761905574651400355502134923946635532361487064122667090907917845003239
                                   :Z 1541764206944523855573315746734580322263253995742414323119579422418913948297)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2279896758427641564849837741680819178720588712886159250225445095133448614365
                                   :Y 3239324005464710428859474732325759141162647158470344762740139339641463334118
                                   :Z 2838440904184771377274212431957121784092323942379897637746447360762975383916)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2765453508742394159889559669415539690756548589284262126064857218880197445965
                                   :Y 1081733132489834768081826441170652936811216296829864437512315572560325609483
                                   :Z 2621837852636422167956011371221167640482340406432218220353518371778147271955)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 751603345208066576507305672879060975426364019900476192192046946948787234695
                                   :Y 998614226722967878436227364183384489600988550564451104306026748479684572083
                                   :Z 559133014332731635273330632671587976653641231278007340159346548734891655434)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1819439739234096468112858779650658069475862205475321102759108031342065429654
                                   :Y 2176554714723509493120901117723947100021850960947295692186319249316943404231
                                   :Z 344471066288688169664543157122076650035304582487806232135910773459288185529)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 3461316822759330559400631520101012838144828196008418204365940717420652812506
                                   :Y 1198716545890448463156903056335649072671164675147553724919695823185183209520
                                   :Z 1688340770181834058342386351549487085053134060228416967480636319387197198340)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1634750951112158690971115242504645924961991790706598984987916423679982333578
                                   :Y 1455924918766224694631444826737944428531668665952450599482955641239282398268
                                   :Z 2058730189145791680988837210149224772984586572679460045748268838591640211358)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1719769814027030916972110374561650213360973654027582025657893716815632176569
                                   :Y 29257478084876998818684445949588607682312497996735755148809752169886592596
                                   :Z 3222898464129824502419734656615469084507125005960502061926474660050158868537)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 128342336205330981837713109049172932941262842985282855652705997027019018879
                                   :Y 699439213250928597368743519950958156996993630672475712746809250548425380205
                                   :Z 2944034162645853471429722926699657157249848309214787275703299369812508280238)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2573572856972497281690868056896494772645461067518173795637135949187363529648
                                   :Y 1786142535897553875388050163619979242312655700618686556574476107534881399198
                                   :Z 508831273830998191104371189435939673061726515409689481207146874119077100599)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2993376760157550897479824935890653722868625263322132874518855498218124646815
                                   :Y 1103265288495713424722818946303069039148809599707933077241035564457413524255
                                   :Z 89437130002174053336306590820759083981233307297628216555787569812363572685)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1244241210627819760931831849069131658948593325347494262241623219995174225967
                                   :Y 2460272476379457136778174622282687150936256007302010333994456951911997830349
                                   :Z 2072195544400414888835579813205739563410161964815598216214750599575890331856)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1489837947676769341557615378906571202918846183282081329677846658632914138362
                                   :Y 2685699052257948997984586419316159130531706947569378304734580091960413743823
                                   :Z 2529821358442082132902629717384808852221792120203765610254819211025913266884)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 943284662345790443101836325314022397451838101881149577846417431594584050500
                                   :Y 2681479388455360547921386496445606515330712785847276914008297350351622357850
                                   :Z 1334570666137326254889003345714863526630980246752089174833970992370228629028)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1689280586864806750577415193206161195856900270586176904055518957217027369948
                                   :Y 3151016529447010982324607977807384208341383212644035558492758750781457120012
                                   :Z 1169809238095937838144097335513873209909227204043950222316794096011671847238)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 3182221619752192286251179513481903080978472512728685029632144715007561822606
                                   :Y 1714972871948745448898040954128603872461096924592994105563996617873797103337
                                   :Z 2063777812144681445035700474907384568260709384156394752685156504302223998541)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1421958067844607466824312181458889769416720231249924706651762765510351275159
                                   :Y 3211116051491783223285478021688634262125930003707442137696251182272677894310
                                   :Z 1287660185919779631868111544252081826766793093470954636554132311406818834380)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 930667501103230412534203701834916279942746940026113755283807815161027901362
                                   :Y 1958102297542494451198898274024192667779031872119719668179623723066916431823
                                   :Z 3215198720219008879994458091783783316127998879369696454530561087917386622468)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 3031168054695339563457708929490586899048576605199948438300862512891632007825
                                   :Y 1430044144966818012779929799443882713311671545619505213867798753832332647665
                                   :Z 782956894079926844871440753169410813675150579463991036422016228696732814104)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1343920496595741266445785836668848247205374090523983666493100583021737629821
                                   :Y 912939086482866147073866319005752728288395068449846124821976252859421651687
                                   :Z 434228807229475790868476654163050434959592945698276227683451512937609356161)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1574548066886645668503503833144753667264297055614565176122234235466516400954
                                   :Y 609442045481626260440432376932739655775331021798874627463553554014302284983
                                   :Z 1454386916930800214231298022462307855906371539162472168088509249693764109861)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1613387454078839529960676027431585018553744765103554229106435154187403964595
                                   :Y 3334559982472820399857943084578494902177365231040230589692616545255564777387
                                   :Z 1171944499864132633211712162273143349573435778311589687951610228792087309854)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1460531108717932142558100045314496661395105360514276291086274672373957223424
                                   :Y 158760087436647563695603618614176277255506358830839873060007472629678262379
                                   :Z 2706983153846173814380228646889274046042559561514504483183487499763489539737)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 3242712688255454578887293877481855007596981227179143915084674071571096651320
                                   :Y 1315159256173700328081469504976078889194896360966914040818705942125047825535
                                   :Z 832363352128770653707147913760875552307718577158748050374426530764656671248)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2917477193902299086623528155770312453999710063584270870726126864525746888889
                                   :Y 2724035803122745000288225652419747014015363113395660546061717201120233055266
                                   :Z 1999051084236023409312143001670965611665752071009078012787031929007177289040)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1174424638021074336807395088401894642941147569918084440781253490750551362869
                                   :Y 324450641700500660614263222865183888320535793845798022943098433035379402528
                                   :Z 2575503796230106775168562405341255679374979935688662929086013313377149184492)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1256926182770719132995948777731654891477936247392661452209123242711953881178
                                   :Y 28671142330726467328746896362521769140028309541040997350779200767043998775
                                   :Z 1699794724004394295973156272507224178170577926005523474978670322247798577068)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 334739419224154622354994854550895350911118885945892472909039649237642732259
                                   :Y 2799548527918226302023102526773174914480056630606189305167850677743590686206
                                   :Z 2275455187170714245053796065562190072795693344904097755734479453343399077846)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2130287450131482915543809691803842066705315571492700636529483860657947096079
                                   :Y 1742906359417660866181291101067087578736720116544087094309025154236849215620
                                   :Z 1902885505518618680735642562275846373001767089799620532766128045702127747227)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1443965196372748581517790167530423746877779581403608011356048577108348321589
                                   :Y 3047317860969022118065386485637928706416584514876686833891474377782868604505
                                   :Z 1860438955900514984104608135644615226895544373638990623179850494674750157065)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 373979153329646924317142013486899652465270282588075030576114636605790833893
                                   :Y 1830629965044421529907008807273190161776534309145923083618570758985400208214
                                   :Z 1355993244444184153402666953373011600329046083111135656693231878348064083713)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2915422001048783081572415915269095465603671344823818872936202737767572010219
                                   :Y 2479908094436784461634192763685328695844981062108863715689016854698703562475
                                   :Z 3287534797833003369720275393084018168226987668824115680562585764139383165699)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1096192300089690832070352104950419315457504777745197943677187024921129493395
                                   :Y 923145676063282653127509902506986152863186496464779892442857122534928206546
                                   :Z 1209209510394524861944850138810742245038143672747007615994358128580656283456)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1427494534545857357361624064706273125852670317331339149275398147318094343643
                                   :Y 2681319589912674780852840936919035559210984717260101816805839990142883748271
                                   :Z 1613235914708748116376440180051206763874486742926942343002315791314734780788)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 3501161433265693139528258204707597663485391722759036646188296553447556685305
                                   :Y 3480707900482063272791930041001398939302660850273061799036525541078201420252
                                   :Z 3291822607577088085504024703417415446089108542584854481915760746732854212611))

   :HS #(#S(EDWARDS-ECC:ED-PROJ-PT :X 1974302046810190521052727773435463576919300773191647121752677684992350196512
                                   :Y 1942455712097677758257534197429904848485165856313546869770099834761607718016
                                   :Z 3046405936106340734742919331564226167786152135532032586229998374593526070440)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2215553676214153811816486733147388661389155804083273006613126378355906867003
                                   :Y 2694994560089428235100425383882962171025596840216454079849753233999168627579
                                   :Z 27366324174122667840442089951131273780505554492241378537768327421663575914)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 612101879524289113945157367524568533068958836675493308072890983001449864850
                                   :Y 3253400907279814569796414507188141465045497811534957861597115874624676637189
                                   :Z 41610828096881501275106816963254611767973147743900913413652420916707462182)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 137721677997826983702636372321487931543771424534746899295120301718414368300
                                   :Y 2783822286109081380885872650513261038408601479040629104046822154978110525577
                                   :Z 1005837562331062190668997984223095653927433438194988955503646572041849518260)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1184984683707921606091886379029603683127225669805100161821061880713794999511
                                   :Y 1501258885281297391446358300201011962462391223088507100825238365283461086425
                                   :Z 985995358802779279646300417527213829110592703516688859198169751698034782644)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1681410562031058712414804198749250077240348617994630210231574995731806736853
                                   :Y 3006596630624209640131040172061611359211618552696857090997039135362685028420
                                   :Z 600854513184217771226653631201153249536741487961545760592350631274223308874)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 3007954511963983918088838994446367292473912915004013105907421620227795959953
                                   :Y 714158347162677135631237314882877710752534946783931777284192078489082279296
                                   :Z 2193075756590886068071646007839129011750020779105965620154234913058467869093)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1039874978577001151404069244787164257411071786485546541375552665647185586824
                                   :Y 219865615025902708203270389098207986442584836583711413526719476599730390852
                                   :Z 1032668661774047339870338584822145981152047751315204173763077890616097196114)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1263718963263418035761212409698892349232865569333737380228691247715608080418
                                   :Y 136979552211793343509899598598375133077698174741944969574889098430873066842
                                   :Z 2885050135238087439994926886011683920942060406059191451443674575701884754930)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 3115469552635008006835775877639155988220591394459099636179791709381017165511
                                   :Y 709031947303006705330263726368992700213471786746005927763580142671981359123
                                   :Z 723161909683866581328930445768890584432821714388651481590539628040282906675)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 66832956222794962918715231285907339899021589266528640827737901723509486553
                                   :Y 3279579888131717989262230656268708637115421693314766194206790458951907827120
                                   :Z 2390956681050305881651844311832393700217090509787421506879081051354944962409)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2044359856531534650258134246968321082434076080270979255742340643832150847708
                                   :Y 950242921324142922209723749498530783957541429811326135848214762189364903349
                                   :Z 1392331793538554577429881346218903564717929579701197126369341013873372169707)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1836544286561363247360219163655048346116019153532519866918763028781607876691
                                   :Y 681160658629948090810423892643144658137138109851088504970437868584050838492
                                   :Z 3383701344692706753827797099396383061098125765290834135858640876558446696223)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1570649595717887117266432784078658281383611507538159489009006726004210637646
                                   :Y 2380484973579488956941440105384209374726019093414441271291969920863082203977
                                   :Z 313213540751656571078070480604048473303670546807799191651804940666330694550)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 320705117761084621975785951509057164720538282981066560530833805041192321565
                                   :Y 2088207943534034769945070053671794826288826027247662740750802324952037732967
                                   :Z 816892691437211397954961045263239583248959539675332936774401691455954882270)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1349988362965692978660857629085658757984565641751105200858802077101453600984
                                   :Y 3223533798909101930852282888976781044246671023876183986361834821765884176861
                                   :Z 702844806921956232954580724255137521549849389817892633478471059786324897771)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 435066602241351937076604613701968445322599205227805205998121017254442700546
                                   :Y 2178469247024698757556141283123844688355186511087240028296668359404182628850
                                   :Z 631100432615092183374135417281797719863893010580295385132452759646497248913)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2210030774760920246881688707447435194954194103871061424572310270601086850181
                                   :Y 2412317737710987649128606798147899860692595185771995801738325045091987872283
                                   :Z 1608848826705386485436928760877745244340572954565160421275555615335012865669)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 3254754092820096610173055961348221781093167403757856515375854912563067853041
                                   :Y 3193333894207037840937193597793544507582929747980189794506327677423162869104
                                   :Z 3163898909869319831520067908304255178361624954868095869547769533217280394791)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2752295802874196241729991966878245056167565213651604272854125446203776484741
                                   :Y 887677259298103146785203214627625862140451759066309834461254748790541243148
                                   :Z 511918641569052849353163053692451165729313285798297939478869162785280104942)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 514088478543646504388001114694734489615740034505646637484329593634528390065
                                   :Y 2869796339029458026279387804410924824625401941869807480351181953246323903464
                                   :Z 3430034709325395567629858725997927596773795259781683718493011237837749027410)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1043264460054603717320154435473370628144000346784568411576557041099663038252
                                   :Y 2794457763094752430580096322603123512434316556209844453861213005720947108256
                                   :Z 2714121696761005459900851518409001912263757220510593853183085582879191319763)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 619533841816294401709120107614996195622305646775441892480491278556219383429
                                   :Y 71202872548498287672935385657055916980251443800880275071330477880029435339
                                   :Z 2965162838440592778071691665243586107265209246041818523967700657334561720192)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1977696675968902117797934859134162939325949381213019957472233863366794156862
                                   :Y 590062230877396450972795484031062108175870455445432597107299578477859681756
                                   :Z 3233379050938545198955817539380054958152248865043549999837798483434482368606)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 422929268688130141636254103707457664008638842283792497830447442914959691844
                                   :Y 190049793482526978920602332833850818426486511777181357048606003091665102382
                                   :Z 2370703655934818447289535178919905841113475863174516184383236515014194244793)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 3054106349630925768054726910479330105776302451296153891411204324365536800625
                                   :Y 731235785713961260477284168013756245923115904329298330938658155155211113946
                                   :Z 2162274685164879056949757081808736668436622447764482346516659483414523421086)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 636066300973146437396649389464753693993946016683988727040811238588544796506
                                   :Y 818346213107063899935417233168858724073756015920969740333603525555203640795
                                   :Z 3536832540562958718464711877486277567797768269169528566030836617561545027267)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 939374111646299076107681072045124334920982744037003240458818598477409943346
                                   :Y 667558765792712262753498640679009401648884192563677180690795240350847761269
                                   :Z 2827549343561115670623504439898076721627346969686144883065278320901221555069)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2504653176081320751169302152939931216925495893825261665938867218484119537289
                                   :Y 426921817464265160253215338181067935467551929533325450137049883207223488142
                                   :Z 3110477614630066419915041538305855476560099477211681379522111582494316323625)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2452720709492734622858699109084443882849026531455562258329439154931609746466
                                   :Y 3011117609540786722218290932672811205706113869395831307487870958826161272576
                                   :Z 2269137342801615220819134061326505340297279736630075490789968280969317572923)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 107433609202220442045709694458891217926940603365858262850912206421491806702
                                   :Y 3381580239157759322746025847609857741725057020188194150725438798062260509028
                                   :Z 2750480835521880984323994621061874703494870704076399776178158692432825469274)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2198205000331654369962086540924167219858842516019211195242438101922628607314
                                   :Y 188367380452828671726885855589731514753672937696258083620436261260279762170
                                   :Z 3345621429608934286889487789965309181206225735364853641747582913653467304785)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2807171078754365179504468494174722033802246467948959533406843687219611704276
                                   :Y 2126232825837629669429345083928400597737281575740027044287225972827429558679
                                   :Z 861891329901154155387073308213511106195369419786406424539534548950029402032)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2026558437563172144763323891695492438824580981354311800377615877722174852110
                                   :Y 3175228622827355252131794249375589958819237728976644114668835577115207253974
                                   :Z 1703537650723208037431605818790567212969945172904002086508624288846620425330)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 3911083886969116240673004845376555183008865591785889822828646248764281212
                                   :Y 3418295182060676784286679825731574704620358637071579798401744482121888390824
                                   :Z 2227193126071463799798832006820464328730357034690395911617459833718322844512)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1306267953894440976162228079682071445463068203341551342138163766584451067179
                                   :Y 2955726091738837008261837510235357120682078374268041631217352979942809568169
                                   :Z 3533650289988153255396344193154004341769520734471025689560632486193816572059)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 441228445009513187661721265720763714856039089012830751129181548430551837321
                                   :Y 13720233656168845197120661060806508559467528912788733709030329777059781814
                                   :Z 1407217045145216220357773561359388832196736862893405516121267880113440879582)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2080312532010041455011605676667671100469381776914458439773898714076035471395
                                   :Y 2950320921014751979037534293496239331360969450258221777769231399100347389357
                                   :Z 3540530350248919206532886527192717817379608417289221792128255277977968213035)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2470637126009133304792253143956901752910577610932067245554539496672441216148
                                   :Y 2704541793802968630501727823125201728882596789764908604708080386891795113163
                                   :Z 3554369237539808403470517160494814345271348433267213145876741153772517125606)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2202110592368133840211548755766972687094082258562729530726098472423603150738
                                   :Y 3466285427390117752583693356453611724031694829851555259544986661676462889872
                                   :Z 2458320933900392027416181479266797832911927376071245992789370957310289182409)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1703175440048148832427810566177391287366765665229995570731416156397547135552
                                   :Y 2940334333194321720494285252145269809500141069594736529634180454802538518808
                                   :Z 548066759184844071928236058206433525433754532995835835265707415994136916916)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 3363716137297053223946100667500259525792549420720299883277062353338186568975
                                   :Y 2186421049389506697732195501848490170371945501632466270009774778477611190378
                                   :Z 3438056129954776639428445435994129835297191431816191558600177156308330067645)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 3096295252190295542313768680458853141674694716324868674147170560957600128423
                                   :Y 1663922509445406657268338685100403605602137830376136630599086295809726586374
                                   :Z 90279181950882188934234541905605051786400764393556432256804125953172448710)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2527088450121221996882730192429927007020993879728406858352826523057136338394
                                   :Y 2516667953769585413435339405932044794676567062678323027804365243822385888378
                                   :Z 1344061277363975598531544798147071751949566618649357865837694269402366997331)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 648110394772570018545339058362614939843160195052734347016591145469272068206
                                   :Y 2554038101858319819758694616426093224118725623953662100954478131962523692737
                                   :Z 484131217744428709992368010198761712787916433475245312482752126383887924501)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1185365528175381981844553224414494091327097839102636417408126700127079935971
                                   :Y 2718984965057960254875500665249172897816090185042261842605091310080836065498
                                   :Z 435400111576964185353200006309341624701665620598816412816855367419198902687)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 3157834163259875293428250102141465344478917205733497130761720544357671605550
                                   :Y 3355062234034087181528567343187917742552888002534265868138318635858268157267
                                   :Z 13299386458405499173454279162938684140759235539624236842677072412855140343)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2603678995505414819252077745783007032433564338781597343529893199097633856126
                                   :Y 1467864437481961503244415798784975730813214461988794710661798674500544810910
                                   :Z 1283301282020527893575490836791822738929617827039034230085066251862056284464)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 140362336702508317920734103991170983363832917017686687641578156634040667693
                                   :Y 2174170782933920561466947518550126461035625557379649083142496395997393238196
                                   :Z 1263774018125373104062455237353618938395685811593156836110619877158323300505)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1537167959406834640249111096124323167159576094896602442271161040797635223031
                                   :Y 3448894487779477422307653500449296102202477352481691883235226526584705093591
                                   :Z 3153746887032911076749691891194954158215706219890687486507658164509121949003)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2216485381399344540115783205875416576696510535861561734578461800375137008702
                                   :Y 726648701613423297346032073305000203355198007613879888825716336738236911084
                                   :Z 2781546392203448726508264327772397648977570404035419092910297735563542912904)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1349767426233465808445012823977521286044641216920009433352920271427189756197
                                   :Y 3284933034111860486355665838943672001976694110781541745494080069605474542366
                                   :Z 2881011932699976388933684426189017487078002335635232480252020243611027129207)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 235969188729511627307034404344211263217146311306249370744131075477590366520
                                   :Y 914591956044951062620849920031000756308745326116975057276153867870737326864
                                   :Z 1535814590157718718096054720658957740869267820684105091314911743706845066678)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1418423544625635358061733296600755497018764268849381320847923989367359248350
                                   :Y 37173247489106030207157708994782380069123252153341678860767162994439567566
                                   :Z 2117529078717784809701935125529970791845031149307472647779207954433203307952)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1695211761246025690623485513681691191775055348821036524317881087142901302057
                                   :Y 2396150593032018789502670872666442811825469692432496041123765414324947668809
                                   :Z 1663910768121878572819829369269170787484982836298012442156478631544906203141)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 605783568557546108006145393700805075441530756039638563156462544032528659548
                                   :Y 2742684536425897725227228815377399690845647981603744565270708596385914529420
                                   :Z 2129065636843698028500647365388104725248182050381958437195223635863224888143)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2581032500003436533228867983561575394465495644840665071591731339606406685150
                                   :Y 298728980753068798553261554962292400428159025931725790698646810839087304056
                                   :Z 2856869800687331043946865760046321371618465470969139850672701393519276669199)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 755623999313467952398487768707580489939921337894077565120997262922034290336
                                   :Y 20069619997423509672196438153193639818526030455625335009080327982676595105
                                   :Z 1080569659966179234095189630374937602401790353062953696449683284448614824876)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1967200222963397906895589609428485899940409376697690306453390271581127484308
                                   :Y 2225305800557468584115588017285223498357322436382106140480813174329379992259
                                   :Z 1053015585214045175921173597273003399170464904325079625748407283510935133710)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 498807339519657622450872880044158751977605751314494268661141670312792882062
                                   :Y 80317912650162459198248682089132458069680221928116025933403220708016663575
                                   :Z 13376339263035277300733406898792745313385002682323853257530248797678155716)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 2739197580391787059177758902956644811520907649827902183840113306939524370242
                                   :Y 909275852337821251690761487510383026214305334636590455674261078468427282603
                                   :Z 1625424628019795955993478284273648919508560938275638262435747413649070905006)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 344327948672451087301260275075702947046232685900247425844768532493220696568
                                   :Y 3353743416655022814137831973405356433986738894026632315628616372284279333697
                                   :Z 2370133529539578399403558693462813640227979592702049900372260435365692821027)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 1004046690532070345892489298182525479587662229943437433062291565087353148837
                                   :Y 71272820424708268925125484564338721964259336013992701377983907667422260393
                                   :Z 768612883303633165968236236148643363289350426259687383336273040547936080755)
         #S(EDWARDS-ECC:ED-PROJ-PT :X 257343624007227848734848331718183374318903777246793446280896454239116997035
                                   :Y 3559791859603445605363050947122976092902343821226965249290371350682370315179
                                   :Z 296434638121815007163580183345037929837977157971858366576139539079696541425))
   ))

(defvar *chk-bp-basis*
  #xdbb5d20d21439523959d090d0477ca7f51e5771f031afa0221f8c1faa860fca7)
|#

;; --------------------------------------------------------------------------------

(defvar *gs*        nil)
(defvar *hs*        nil)
(defvar *hpt*       nil)

(defun init-basis (&key (nbits *max-bit-length*)
                        (curve (ed-curve-name *edcurve*)))
  (cond (*bp-basis*
         (cond ((eql curve *curve*)
                (cond ((= nbits *nbits*)
                       *bp-basis*)
                      ((< nbits *nbits*)
                       (make-bp-basis
                        :curve  curve
                        :nbits  nbits
                        :hpt    *bhpt*
                        :gs     *bgs*
                        :hs     *bhs*))
                      (t
                       (make-bp-basis
                        :curve  curve
                        :nbits  nbits
                        :hpt    *bhpt*
                        :gs     (concatenate 'vector 
                                             (basis-pts (- nbits *nbits*))
                                             *bgs*)
                        :hs     (concatenate 'vector
                                             (basis-pts (- nbits *nbits*))
                                             *bhs*)))
                      ))
               (t
                (make-bp-basis
                 :curve  curve
                 :nbits  nbits
                 :hpt    (ed-projective (ed-random-generator))
                 :gs     (basis-pts nbits)
                 :hs     (basis-pts nbits)))
               ))

        (t
         (setf *bp-basis*
               (make-bp-basis
                :curve  curve
                :nbits  nbits
                :hpt    (ed-projective (ed-random-generator))
                :gs     (basis-pts nbits)
                :hs     (basis-pts nbits))
               ))
        ))

(defun do-with-basis (basis fn)
  (let ((*bp-basis*  basis))
    (with-ed-curve *curve*
      (with-mod *ed-r*
        (let* ((*hpt*  *bhpt*)
               (*gs*   *bgs*)
               (*hs*   *bhs*))
          (funcall fn))))))

(defmacro with-basis (basis &body body)
  `(do-with-basis ,basis
                  (lambda ()
                    ,@body)))

#+:LISPWORKS
(editor:setup-indent "with-basis" 1)

;; ---------------------------------------------------------------------

(defun make-range-proofs (&key (nbits *max-bit-length*)
                               vals)
  (with-basis (init-basis :nbits nbits)
    (let* ((prover (make-range-prover))
           (proofs nil)
           (gammas nil))
      (dolist (val vals)
        (multiple-value-bind (proof gamma)
            (funcall prover val)
          (push proof proofs)
          (push gamma gammas)))
      (let* ((sum-cmt (reduce 'ed-add
                              (mapcar (um:compose 'ed-decompress-pt 'range-proof-vcmt) proofs)
                              :initial-value (ed-neutral-point)))
             (sum-gamma (reduce 'm+ gammas)))
        (make-range-proof-block
         :basis     *bp-basis*
         :proofs    (nreverse proofs)
         :sum-cmt   (ed-compress-pt sum-cmt)
         :sum-gamma sum-gamma)
        ))))

(defmethod validate-range-proofs ((proof-block range-proof-block))
  (with-basis (range-proof-block-basis proof-block)
    (every 'internal-validate-range-proof (range-proof-block-proofs proof-block))))

;; -------------------------------------------------------------------
;; Transaction support -- fixed basis

(defmethod make-range-proof (val &key (gamma (rand-val)))
  (with-basis (init-basis :nbits *max-bit-length*)
    (let ((prover (make-range-prover)))
      (funcall prover val gamma))))

(defmethod validate-range-proof ((prf range-proof))
  (with-basis (init-basis :nbits *max-bit-length*)
    (internal-validate-range-proof prf)))

(defmethod proof-simple-commitment ((proof range-proof))
  "This is the item used to form the hash-lock on a send in a
transaction. Hash this value with the public key of the recipient to
lock it to the recipient."
  (range-proof-vcmt proof))

(defun hpt ()
  "Return the *hpt* curve point used to make Pedersen commitments"
  *bhpt*)

;; ------------------------------
;; Construct a range-prover for use on multiple values

(defun make-range-prover ()
  
  ;; let's compute the basis vectors just once, and share them
  (let* ((hpt   *hpt*)
         (hs    *hs*)
         (gs    *gs*)
         (nbits *nbits*))

    (labels
        ;; ---------------------------------------------
        ((make-range-proof (v &optional (gamma (rand-val)))
           (check-type v     (integer 0))
           (check-type gamma (integer 1))
           (assert (<= 0 v (1- (ash 1 nbits))))
           (let* ((vcmt       (simple-commit hpt gamma v))
                  (vcmt-cmpr  (ed-compress-pt vcmt))
                  
                  (a_l        (bits-vector v nbits))
                  (a_r        (vec-decr a_l 1))
                  (alpha      (rand-val))
                  (acmt       (vec-commit hpt alpha hs a_r gs a_l))
                  (acmt-cmpr  (ed-compress-pt acmt))
                  
                  (s_l        (random-vec nbits))
                  (s_r        (random-vec nbits))
                  (rho        (rand-val))
                  (scmt       (vec-commit hpt rho hs s_r gs s_l))
                  (scmt-cmpr  (ed-compress-pt scmt))
                  
                  ;; publish Acmt, Scmt
                  
                  (y          (int (hash/256 vcmt-cmpr acmt-cmpr scmt-cmpr)))
                  (z          (int (hash/256 y)))
                  
                  (poly_l0    (vec-decr a_l z))
                  (poly_l1    s_l)
                  (poly_l     (vector poly_l0 poly_l1))
                  
                  (yvec       (pow-vec y nbits))
                  (zsq        (m* z z))
                  (poly_r0    (vec-add
                               (vec-hadamard-prod yvec
                                                  (vec-incr a_r z))
                               (vec-scale (twos-vec nbits) zsq)))
                  (poly_r1    (vec-hadamard-prod yvec s_r))
                  (poly_r     (vector poly_r0 poly_r1))              
                  
                  (poly_t     (poly-dot-prod poly_l poly_r))
                  (t1         (aref poly_t 1))
                  (t2         (aref poly_t 2))
                  
                  (tau1       (rand-val))
                  (tau2       (rand-val))
                  
                  (t1cmt      (simple-commit hpt tau1 t1))
                  (t1cmt-cmpr (ed-compress-pt t1cmt))
                  (t2cmt      (simple-commit hpt tau2 t2))
                  (t2cmt-cmpr (ed-compress-pt t2cmt))
                  
                  ;; publish T1cmt, T2cmt
                  
                  (x          (int (hash/256 t1cmt-cmpr t2cmt-cmpr)))
                  (lvec       (vec-add poly_l0 (vec-scale poly_l1 x)))
                  (rvec       (vec-add poly_r0 (vec-scale poly_r1 x)))
                  (t_hat      (vec-dot-prod lvec rvec))
                  (tau_x      (vec-dot-prod (pow-vec x 3)
                                            (vector (m* gamma zsq) tau1 tau2)))
                  (mu         (m+ alpha
                                  (m* rho x)))
                  
                  ;; publish tau_x, mu, t_hat, lvec, rvec
                  )
             (values
              (%make-range-proof
               ;; commitments
               :vcmt  vcmt-cmpr
               :acmt  acmt-cmpr
               :scmt  scmt-cmpr
               :t1cmt t1cmt-cmpr
               :t2cmt t2cmt-cmpr
               ;; parameters
               :tau_x tau_x
               :mu    mu
               :t_hat t_hat
               :dot-proof (make-lr-dot-prod-proof y mu t_hat lvec rvec)
               ;; challenge values x, y, z
               :x     x
               :y     y
               :z     z)
              gamma)
             )))
      
      ;; ---------------------------------------------------
      #'make-range-proof)))

;; ---------------------------------------------------------------------
;; Range proof validation

(defun internal-validate-range-proof (proof)
  (let* ((nbits     *nbits*)
         (y         (range-proof-y proof))
         (yvec      (pow-vec y nbits))
         (z         (range-proof-z proof))
         (zsq       (m* z z))
         (x         (range-proof-x proof))
         (xsq       (m* x x))
         (delta     (m- (m* (m- z zsq)
                            (reduce 'm+ yvec))
                        (m* (1- (ash 1 nbits))
                            (m* z zsq))))
         (chck-v-l  (simple-commit *hpt* (range-proof-tau_x proof)
                                   (range-proof-t_hat proof)))
         (vcmt      (ed-decompress-pt (range-proof-vcmt proof)))
         (t1cmt     (ed-decompress-pt (range-proof-t1cmt proof)))
         (t2cmt     (ed-decompress-pt (range-proof-t2cmt proof)))
         (chck-v-r  (ed-add (ed-mul vcmt zsq)
                            (ed-add (ed-nth-pt delta)
                                    (ed-add (ed-mul t1cmt x)
                                            (ed-mul t2cmt xsq))
                                    ))))
    (when (ed-pt= chck-v-l chck-v-r)
      (let* ((*hs*      (map 'vector 'ed-mul
                             *hs*
                               (pow-vec (m/ y) nbits)))
             (hpows     (vec-add (vec-scale yvec z)
                                 (vec-scale (twos-vec nbits) zsq)))
             (gpows     (vec-scale (ones-vec nbits) (m- z)))
             (acmt      (ed-decompress-pt (range-proof-acmt proof)))
             (scmt      (ed-decompress-pt (range-proof-scmt proof)))
             (chk-p-l   (ed-add acmt
                                (vec-commit scmt x
                                            *hs* hpows
                                            *gs* gpows)))
             (dot-proof (range-proof-dot-proof proof))
             (p         (ed-decompress-pt (dot-prod-proof-pcmt dot-proof))))
        
        (when (ed-pt= chk-p-l p)
          (fast-validate-dot-prod-proof dot-proof))
        ))))

;; -----------------------------------------------------------

(defun make-lr-dot-prod-proof (y mu t_hat lvec rvec)
  ;; set up conditions for range proofs to provide Bulletproofs on
  ;; vector dot products
  (let* ((nbits (length lvec))
         (*hs*  (map 'vector 'ed-mul
                     *hs*
                     (pow-vec (m/ y) nbits)))
         (u     (ed-mul *hpt* (m/ mu t_hat)))
         (p     (vec-commit *hpt* mu
                            *hs*  rvec
                            *gs*  lvec)))
    
    (make-dot-prod-proof u p lvec rvec)))


(defun make-dot-prod-proof (u pcmt a b)
  ;; for input vectors a, b, commitment p, aux arg u
  ;; global basis vectors g, h, order n = length g
  ;; n should be pow2
  ;;
  ;; construct proof that c = <a b> and P = g^a h^b u^c
  ;;
  (um:nlet-tail iter ((n  (length a))
                      (g  *gs*)
                      (h  *hs*)
                      (p  pcmt)
                      (a  a)
                      (b  b)
                      (accum nil))
    (if (eql 1 n)
        (%make-dot-prod-proof ;; validate as P = g^a h^b u^(a*b)
                              :u    (ed-compress-pt u)
                              :pcmt (ed-compress-pt pcmt)
                              :a    (aref a 0)
                              :b    (aref b 0)
                              :xlrs (nreverse accum))
      ;; else
      (let* ((n/2  (ash n -1))
             (gl   (subseq g 0 n/2))
             (gr   (subseq g n/2))
             (hl   (subseq h 0 n/2))
             (hr   (subseq h n/2))
             (al   (subseq a 0 n/2))
             (ar   (subseq a n/2))
             (bl   (subseq b 0 n/2))
             (br   (subseq b n/2))
             (cl   (vec-dot-prod al br))
             (cr   (vec-dot-prod ar bl))
             (l    (vec-commit u cl
                               hl br
                               gr al))
             (r    (vec-commit u cr
                               hr bl
                               gl ar))
             ;; publish L,R
             (lcmpr (ed-compress-pt l))
             (rcmpr (ed-compress-pt r))
             (x     (int (hash/256 lcmpr rcmpr))) ;; challenge x
             
             (invx  (m/ x))
             (gp    (map 'vector
                         (lambda (ptl ptr)
                           (ed-add
                            (ed-mul ptl invx)
                            (ed-mul ptr x)))
                         gl gr))
             (hp    (map 'vector
                         (lambda (ptl ptr)
                           (ed-add
                            (ed-mul ptl x)
                            (ed-mul ptr invx)))
                         hl hr))
             
             (xsq    (m* x x))
             (xsqinv (m/ xsq))
             (pp     (ed-add
                      (ed-mul l xsq)
                      (ed-add p
                              (ed-mul r xsqinv))))
             
             (ap     (vec-add
                      (vec-scale al x)
                      (vec-scale ar invx)))
             (bp     (vec-add
                      (vec-scale bl invx)
                      (vec-scale br x))))
        
        (iter n/2 gp hp pp ap bp
              (cons (list x lcmpr rcmpr) accum)))
      )))

;; -------------------------------------------------------
#|
  ;; not needed with fast validation running properly...
(defun validate-dot-prod-proof (proof)
  (let* ((u         (ed-decompress-pt (dot-prod-proof-u proof)))
         (p         (ed-decompress-pt (dot-prod-proof-pcmt proof)))
         (a         (dot-prod-proof-a proof))
         (b         (dot-prod-proof-b proof))
         (xlrs      (dot-prod-proof-xlrs proof)))
    (um:nlet-tail iter ((gs   *gs*)
                        (hs   *hs*)
                        (p    p)
                        (xlrs xlrs))
      (if (endp xlrs)
          (ed-pt= p (ed-add
                     (ed-mul (aref gs 0) a)
                     (ed-add
                      (ed-mul (aref hs 0) b)
                      (ed-mul u (m* a b)))))
        ;; else
        (destructuring-bind (x lcmpr rcmpr) (first xlrs)
          (let* ((l    (ed-decompress-pt lcmpr))
                 (r    (ed-decompress-pt rcmpr))
                 (n/2  (ash (length gs) -1))
                 (gl   (subseq gs 0 n/2))
                 (gr   (subseq gs n/2))
                 (hl   (subseq hs 0 n/2))
                 (hr   (subseq hs n/2))
                 (xsq  (m* x x))
                 (pp   (ed-add
                        (ed-mul l xsq)
                        (ed-add
                         p
                         (ed-mul r (m/ xsq)))))
                 
                 (invx  (m/ x))
                 (gp    (map 'vector
                             (lambda (ptl ptr)
                               (ed-add
                                (ed-mul ptl invx)
                                (ed-mul ptr x)))
                             gl gr))
                 (hp    (map 'vector
                             (lambda (ptl ptr)
                               (ed-add
                                (ed-mul ptl x)
                                (ed-mul ptr invx)))
                             hl hr)))
            (iter gp hp pp (cdr xlrs))))
        ))))
|#             
;; --------------------------------------------------------------

(defun compute-svec (xlrs nbits)
  (let ((svec (make-array nbits))
        (xs   (mapcar 'first xlrs)))
    (loop for ix from 0 below nbits
          do
          (setf (aref svec ix)
                (let ((prod 1))
                  (loop for jx from 0
                        for x in xs
                        do
                        (setf prod (m* prod
                                       (if (logbitp jx ix)
                                           x
                                         (m/ x)))))
                  prod)))
    svec))
  
(defun fast-validate-dot-prod-proof (proof)
  (let* ((nbits     *nbits*)
         (u         (ed-decompress-pt (dot-prod-proof-u proof)))
         (p         (ed-decompress-pt (dot-prod-proof-pcmt proof)))
         (a         (dot-prod-proof-a proof))
         (b         (dot-prod-proof-b proof))
         (xlrs      (reverse (dot-prod-proof-xlrs proof)))
         (sv        (compute-svec xlrs nbits))
         (svinv     (map 'vector 'm/ sv))
         (chk_l     (vec-commit u (m* a b)
                                *gs* (vec-scale sv a)
                                *hs* (vec-scale svinv b)))
         (chk_r     (reduce (lambda (ans triple)
                              (destructuring-bind (x lcmpr rcmpr) triple
                                (let ((xsq (m* x x))
                                      (l   (ed-decompress-pt lcmpr))
                                      (r   (ed-decompress-pt rcmpr)))
                                  (ed-add ans
                                          (ed-add
                                           (ed-mul l xsq)
                                           (ed-mul r (m/ xsq))))
                                  )))
                            xlrs
                            :initial-value p)))
    (ed-pt= chk_l chk_r)))

;; ----------------------------------------------------------------------
;; test it out
#|
(defun tst (nbits &rest vals)
  (let* ((proofs (apply 'make-range-proofs nbits vals)))
    (assert (validate-range-proofs proofs))
    proofs))

(defun timing-test (&optional (niter 10))
  (let* ((vals   (loop repeat niter collect (random-between 0 #.(ash 1 64))))
         (proofs (time (apply 'make-range-proofs 64 vals))))
    (assert (time (validate-range-proofs proofs)))
    proofs))

(progn
  (setf *bp-basis* nil)
  (with-ed-curve :curve1174
    ;; force init allocation of basis vectors
    (let ((prf (make-range-proof 123456789)))
      (time (loop repeat 10 do
                  ;; (make-range-proof 123456789)
                  (validate-range-proof prf)))
      )))

(let* ((bits '(251 382 414 521))
       (gen  '(3.6 6.2 7.1 11))
       (val  '(1.4 2.5 2.9 4.4)))
  (plt:plot 'timings bits gen
            :clear t
            :ylog  t
            :xrange '(200 600)
            :yrange '(1 15)
            :plot-joined t
            :symbol :circle
            :legend "Make BulletProof"
            :title  "Timings for BulletProofs vs Curve Size"
            :xtitle "Curve Size [bits]"
            :ytitle "Time per BulletProof [sec]")
  (plt:plot 'timings bits val
            :color :red
            :symbol :circle
            :plot-joined t
            :legend "Validate BulletProof"))
|#

